(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{308:function(e,t,a){},356:function(e,t,a){e.exports=a(651)},361:function(e,t,a){},362:function(e,t,a){},363:function(e,t,a){},364:function(e,t,a){},372:function(e,t,a){},467:function(e,t,a){},558:function(e,t,a){},559:function(e,t,a){},562:function(e,t,a){},564:function(e,t,a){},573:function(e,t,a){},608:function(e,t,a){},632:function(e,t){},650:function(e,t,a){},651:function(e,t,a){"use strict";a.r(t);var n={};a.r(n),a.d(n,"clearStore",function(){return ne}),a.d(n,"fetchChats",function(){return re}),a.d(n,"fetchMessages",function(){return ce}),a.d(n,"closeChat",function(){return se}),a.d(n,"togglePanel",function(){return oe}),a.d(n,"newMessage",function(){return ie}),a.d(n,"loginUser",function(){return le}),a.d(n,"regUser",function(){return ue}),a.d(n,"changePage",function(){return de}),a.d(n,"fetchUser",function(){return me}),a.d(n,"search",function(){return he}),a.d(n,"toggleSearch",function(){return pe}),a.d(n,"newChat",function(){return fe}),a.d(n,"addChatToList",function(){return ge}),a.d(n,"deleteMessage",function(){return be}),a.d(n,"deleteMessageDone",function(){return Ee}),a.d(n,"editMessage",function(){return Oe}),a.d(n,"editMessageDone",function(){return ve}),a.d(n,"updateAvatar",function(){return ye}),a.d(n,"editAbout",function(){return je}),a.d(n,"editEmail",function(){return we}),a.d(n,"confirmEmail",function(){return Se}),a.d(n,"sendOptions",function(){return ke}),a.d(n,"sendEmail",function(){return Ce}),a.d(n,"clearLogin",function(){return Ne}),a.d(n,"clearReg",function(){return xe}),a.d(n,"typingMessage",function(){return Ie}),a.d(n,"newTypingMessage",function(){return Te}),a.d(n,"setTyping",function(){return _e}),a.d(n,"onlineUser",function(){return Ae}),a.d(n,"setReadMessage",function(){return Pe}),a.d(n,"readChat",function(){return Le}),a.d(n,"increaseCount",function(){return De});var r=a(0),c=a.n(r),s=a(45),o=a.n(s),i=(a(361),a(309)),l=(a(362),a(363),a(19)),u=(a(364),a(114)),d=a(117),m=a(26),h="FETCH_CHATS",p="FETCH_CHATS_DONE",f="FETCH_MESSAGES",g="FETCH_MESSAGES_DONE",b="CLOSE_CHAT",E="TOGGLE_PANEL",O="TOGGLE_SEARCH",v="ADD_NEW_MESSAGE",y="LOGIN",j="LOGIN_FAIL",w="REG",S="REG_FAIL",k="CHANGE_PAGE",C="REMOVE_STORE",N="FETCH_USER",x="FETCH_USER_DONE",I="SEARCH",T="SEARCH_DONE",_="CREATE_CHAT",A="CREATE_CHAT_DONE",P="ADD_CHAT_TO_LIST",L="DELETE_MESSAGE",D="DELETE_MESSAGE_DONE",M="EDIT_MESSAGE",F="EDIT_MESSAGE_DONE",H="UPDATE_AVATAR",U="UPDATE_AVATAR_DONE",G="UPDATE_ABOUT",R="UPDATE_ABOUT_DONE",z="UPDATE_EMAIL",B="UPDATE_EMAIL_DONE",J="SEND_CONFIRM_MESSAGE",W="SEND_OPTIONS",q="SEND_OPTIONS_DONE",Y="SEND_EMAIL",V="CLEAR_LOGIN",X="CLEAR_REG",Z="TYPING_MESSAGE",K="NEW_TYPING_MESSAGE",$="SET_TYPING_MESSAGE",Q="SET_ONLINE_USER",ee="SET_READ_MESSAGE",te="READ_MESSAGE",ae="INCREASE_COUNT",ne=function(){return{type:C}},re=function(){return{type:h}},ce=function(e,t){return{type:f,payload:{id:e,user:t}}},se=function(){return{type:b}},oe=function(){return{type:E}},ie=function(e){return{type:v,payload:{message:e}}},le=function(e,t){return{type:y,payload:{login:e,password:t}}},ue=function(e,t,a){return{type:w,payload:{login:e,password:t,avatar:a}}},de=function(e){return{type:k,payload:e}},me=function(){return{type:N}},he=function(e){return{type:I,payload:{search:e}}},pe=function(){return{type:O}},fe=function(e,t){return{type:_,payload:{userId:e,user:t}}},ge=function(e,t,a){return{type:P,payload:{chatId:e,user:t,setChat:a}}},be=function(e,t){return{type:L,payload:{messageId:e,chatId:t}}},Ee=function(e){return{type:D,payload:{message:e}}},Oe=function(e,t,a){return{type:M,payload:{messageId:e,chatId:t,message:a}}},ve=function(e){return{type:F,payload:{message:e}}},ye=function(e){return{type:H,payload:{src:e}}},je=function(e){return{type:G,payload:{message:e}}},we=function(e){return{type:z,payload:{email:e}}},Se=function(e){return{type:J,payload:{email:e}}},ke=function(e){return{type:W,payload:{options:e}}},Ce=function(e){return{type:Y,payload:{message:e}}},Ne=function(){return{type:V}},xe=function(){return{type:X}},Ie=function(e,t){return{type:Z,payload:{chatId:e,userId:t}}},Te=function(e){return{type:K,payload:{chatId:e}}},_e=function(e,t,a){return{type:$,payload:{chatId:e,isTyping:t,timeTyping:a}}},Ae=function(e,t){return{type:Q,payload:{userId:e,status:t}}},Pe=function(e){return{type:ee,payload:{chatId:e}}},Le=function(e,t){return{type:te,payload:{userId:t,chatId:e}}},De=function(e){return{type:ae,payload:{chatId:e}}},Me=a(27),Fe=a(150),He=a(8),Ue=a(667),Ge=a(345),Re=a(652),ze=a(672),Be=a(71),Je=a(662),We=a(668),qe=a(663),Ye=a(664),Ve=a(84),Xe=a(85),Ze=a(94),Ke=a(86),$e=a(70),Qe=a(95),et=a(311),tt=a.n(et),at=(a(372),a(12)),nt=a.n(at),rt=a(87),ct=a(49),st=a(312),ot=a.n(st),it=a(115),lt=a.n(it),ut=a(151),dt=a.n(ut),mt="https://igor-babin-chat-java.herokuapp.com",ht="".concat(mt,"/ws"),pt="".concat(mt,"/api/chats"),ft="".concat(mt,"/api/chat/"),gt="".concat(mt,"/api/auth/login"),bt="".concat(mt,"/api/me"),Et="".concat(mt,"/req"),Ot="".concat(mt,"/api/users"),vt="".concat(mt,"/api/chat"),yt="".concat(mt,"/api/message"),jt="".concat(mt,"/api/uploadFile"),wt="".concat(mt,"/api/user/avatar"),St="".concat(mt,"/api/user/about"),kt="".concat(mt,"/api/user/email"),Ct="".concat(mt,"/api/email/confirm"),Nt="".concat(mt,"/api/user/confirm"),xt="".concat(mt,"/api/user/options"),It="".concat(mt,"/api/email/send-message");lt.a.extend(dt.a);var Tt=function(){return{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}},_t=function(e){return Object(ct.a)(e||[]).sort(function(e,t){var a=e.message?e.message.time:0;return(t.message?t.message.time:0)-a})},At=function(){var e=Object(rt.a)(nt.a.mark(function e(t,a){var n,r;return nt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new FormData).append("file",t),n.append("height",""+a),e.next=5,fetch(jt,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))},method:"POST",body:n});case 5:return r=e.sent,e.next=8,r.json();case 8:return r=e.sent,e.abrupt("return",r);case 10:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),Pt=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=t?1e3:1024;if(Math.abs(e)<a)return e+" B";var n=t?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],r=-1;do{e/=a,++r}while(Math.abs(e)>=a&&r<n.length-1);return e.toFixed(1)+" "+n[r]},Lt=function(e){return new Promise(function(t,a){try{var n=new FileReader;n.onload=function(){var e=new Image;e.src=n.result,e.onload=function(){t(e.height)}},n.readAsDataURL(e)}catch(r){a(r.message)}})},Dt=function(e){function t(e){var a;return Object(Ve.a)(this,t),(a=Object(Ze.a)(this,Object(Ke.a)(t).call(this,e))).state={preview:null,src:""},a.onCrop=a.onCrop.bind(Object($e.a)(a)),a.onClose=a.onClose.bind(Object($e.a)(a)),a}return Object(Qe.a)(t,e),Object(Xe.a)(t,[{key:"onClose",value:function(){this.setState({preview:null})}},{key:"onCrop",value:function(e){this.setState({preview:e})}},{key:"onSave",value:function(){var e=this,t=this.state.preview.split(","),a=Object(l.a)(t,2),n=a[0],r=(a[1],n.split(";")),c=Object(l.a)(r,1)[0].split("/")[1],s=function(e,t){for(var a=e.split(","),n=a[0].match(/:(.*?);/)[1],r=atob(a[1]),c=r.length,s=new Uint8Array(c);c--;)s[c]=r.charCodeAt(c);return new File([s],t,{type:n})}(this.state.preview,"avatar.".concat(c));At(s).then(function(t){e.props.onClose(t.fileDownloadUri)}).catch(console.log)}},{key:"render",value:function(){var e=this;return c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:"cropper"},c.a.createElement(tt.a,{width:320,height:200,onCrop:this.onCrop,onClose:this.onClose,onBeforeFileLoad:this.onBeforeFileLoad}),c.a.createElement("div",{className:"preview"},this.state.preview&&c.a.createElement("img",{src:this.state.preview,alt:"Preview"}))),c.a.createElement("div",{style:{display:"flex",justifyContent:"center"}},c.a.createElement(Re.a,{color:"blue",onClick:function(){return e.props.onClose()}},"Close"),this.state.preview&&c.a.createElement(Re.a,{color:"blue",onClick:function(){return e.onSave()}},"Save")))}}]),t}(c.a.Component),Mt=a(317),Ft=(a(467),a(39)),Ht=Object(Me.b)(function(e){return{userStore:e.user.data}},function(e){return{actions:Object(m.bindActionCreators)(n,e)}})(function(e){var t=e.user,a=Object(r.useState)(!1),n=Object(l.a)(a,2),s=n[0],o=n[1],i=Object(r.useState)(!1),m=Object(l.a)(i,2),h=m[0],p=m[1],f=Object(r.useState)(t.about),g=Object(l.a)(f,2),b=g[0],E=g[1],O=function(){E(t.about),p(!1)},v=Object(r.useState)(Object(He.a)({},t.options)),y=Object(l.a)(v,2),j=y[0],w=y[1],S=function(e,t){w(Object(He.a)({},j,Object(Fe.a)({},e,t)))},k=Object(r.useState)(!1),C=Object(l.a)(k,2),N=C[0],x=C[1],I=Object(r.useState)(t.email),T=Object(l.a)(I,2),_=T[0],A=T[1],P=function(){A(t.email),x(!1)};return Object(r.useEffect)(function(){N&&A(t.email)},[N]),Object(r.useEffect)(function(){h&&E(t.about)},[h]),Object(r.useEffect)(function(){w(t.options)},[t.options]),c.a.createElement(Ue.a,{open:e.close,closeOnDimmerClick:!0,onClose:function(){return e.setClose(!1)},centered:!1},c.a.createElement(Ue.a.Header,{as:"h1"},c.a.createElement("div",{className:"header-wrap-view"},t.username,e.isEdit&&c.a.createElement("div",{className:"icon-wrap",onClick:e.onLogOut},c.a.createElement(u.a,{icon:d.c})))),c.a.createElement(Ue.a.Content,null,c.a.createElement("div",{className:"content-wrapper"},s?c.a.createElement(c.a.Fragment,null,c.a.createElement(Dt,{onClose:function(t){o(!1),t&&e.actions.updateAvatar(t)}})):c.a.createElement("div",{className:"avatar"},c.a.createElement(Ge.a,{wrapped:!0,size:"medium",src:t.avatar,circular:!0}),e.isEdit&&c.a.createElement(Re.a,{color:"blue",onClick:function(){return o(!0)}},"Upload photo")),c.a.createElement(Ue.a.Description,null,c.a.createElement(ze.a,{as:"h4"},"Profile Info"),c.a.createElement("div",{className:"key-value"},c.a.createElement("div",{className:"key"},"About",e.isEdit&&(h?c.a.createElement(c.a.Fragment,null,c.a.createElement("span",{onClick:O},c.a.createElement(Be.a,{name:"window close outline",color:"blue"})),c.a.createElement("span",{onClick:function(){if(b.length>255)return Ft.NotificationManager.error("Too big message");e.actions.editAbout(b),O()}},c.a.createElement(Be.a,{name:"check",color:"blue"}))):c.a.createElement("span",{onClick:function(){return p(!0)}},c.a.createElement(Be.a,{name:"edit",color:"blue"})))),c.a.createElement("div",{className:"value"},e.isEdit&&h?c.a.createElement(Je.a,{value:b,onChange:function(e,t){return E(t.value)},style:{minHeight:100}}):t.about)),c.a.createElement("div",{className:"key-value"},c.a.createElement("div",{className:"key"},c.a.createElement("div",null,"Email",e.isEdit&&(N?c.a.createElement(c.a.Fragment,null,c.a.createElement("span",{onClick:P},c.a.createElement(Be.a,{name:"window close outline",color:"blue"})),c.a.createElement("span",{onClick:function(){e.actions.editEmail(_),P()}},c.a.createElement(Be.a,{name:"check",color:"blue"}))):c.a.createElement("span",{onClick:function(){return x(!0)}},c.a.createElement(Be.a,{name:"edit",color:"blue"})))),c.a.createElement(ze.a,{as:"h6",color:t.confirm?"green":"red"},t.confirm?"confirm":e.isEdit&&c.a.createElement(We.a,{content:"Click to send confirm email",trigger:c.a.createElement("span",{style:{marginLeft:0},onClick:function(){e.actions.confirmEmail(t.email||"")}},"no confirm")}))),c.a.createElement("div",{className:"value"},e.isEdit&&N?c.a.createElement(qe.a,{value:_,onChange:function(e,t){return A(t.value)}}):t.email)),e.isEdit&&c.a.createElement("div",{className:"notific-setting"},c.a.createElement(ze.a,{as:"h4"},"Notification settings"),!t.confirm&&c.a.createElement(ze.a,{as:"h5",color:"red"},"Works only when you confirm email"),c.a.createElement("div",{className:"checkbox-wrap"},c.a.createElement(Ye.a,{toggle:!0,checked:j.newChat,onChange:function(){return S("newChat",!j.newChat)},label:"New chat"})),c.a.createElement("div",{className:"checkbox-wrap"},c.a.createElement(Ye.a,{toggle:!0,checked:j.eachMessage,onChange:function(){return S("eachMessage",!j.eachMessage)},label:"Each new message"})),c.a.createElement("div",{className:"checkbox-wrap"},c.a.createElement(Ye.a,{toggle:!0,checked:j.sendMessage,onChange:function(){return S("sendMessage",!j.sendMessage)},label:"Option to send particular message to email"})),Object(Mt.isEqual)(j,t.options)?"":c.a.createElement(Re.a,{color:"blue",onClick:function(){e.actions.sendOptions(j)}},"Save settings"))))))}),Ut=(a(558),function(){return c.a.createElement("div",{className:"typing-indicator"},c.a.createElement("span",{className:"span"}),c.a.createElement("span",{className:"span"}),c.a.createElement("span",{className:"span"}),c.a.createElement("span",{className:"text"},"typing"))}),Gt=(a(559),function(e){return c.a.createElement("div",{className:"avatar ".concat(e.online&&"online")},c.a.createElement("img",{width:e.width,height:e.height,className:"rounded-circle",src:e.src,alt:""}),0!==e.unread&&e.unread&&c.a.createElement("span",{className:"unread"},e.unread))}),Rt=a(93),zt=a.n(Rt),Bt=Object(Me.b)(function(e){return{chat:e.chat,user:e.user}},function(e){return{actions:Object(m.bindActionCreators)(n,e)}})(function(e){var t=Object(r.useState)(!1),a=Object(l.a)(t,2),n=a[0],s=a[1],o=Object(r.useState)(null),i=Object(l.a)(o,2),m=i[0],h=i[1],p=function(e){e&&(s(!0),h(e))};Object(r.useEffect)(function(){m&&m.id===e.user.data.id&&h(e.user.data)},[e.user]);var f=e.chat.user;return c.a.createElement("div",{className:"header-wrap"},c.a.createElement("div",{className:"left-side"},c.a.createElement("div",{className:"icon-wrap",onClick:function(){return e.actions.togglePanel()}},c.a.createElement(u.a,{icon:d.a})),c.a.createElement("div",{className:"icon-wrap",onClick:function(){return e.actions.toggleSearch()}},c.a.createElement(u.a,{icon:d.b}))),f&&c.a.createElement("div",{className:"header-user",onClick:function(){return p(f)}},c.a.createElement("div",{className:"avatar"},c.a.createElement(Gt,{src:f.avatar,height:35,width:35,online:f.online})),c.a.createElement("div",{className:"name-wrapper"},c.a.createElement("div",{className:"name"},f.username),e.chat.isTyping?c.a.createElement(Ut,null):c.a.createElement("span",{className:"user-status"},e.chat.user.online?"online":c.a.createElement(zt.a,{date:e.chat.user.time})))),c.a.createElement("div",{className:"right-size",onClick:function(){return p(e.user.data)}},c.a.createElement(Gt,{src:e.user.data.avatar,height:35,width:35,online:e.user.data.online})),m&&c.a.createElement(Ht,{isEdit:m.id===e.user.data.id,close:n,setClose:function(){h(null),s(!1)},user:m,actions:e.actions,onLogOut:function(){localStorage.removeItem("token"),e.actions.clearStore()}}))}),Jt=(a(562),a(199)),Wt=a.n(Jt),qt=function(e){var t=e.name,a=e.date,n=e.message,s=e.id,o=e.avatar,i=e.show,u=void 0!==i&&i,d=e.typing,m=e.timeTyping,h=e.online,p=Object(r.useState)(m),f=Object(l.a)(p,2),g=(f[0],f[1]),b=Object(r.useState)(null),E=Object(l.a)(b,2),O=E[0],v=E[1];Object(r.useEffect)(function(){g(m),O&&clearTimeout(O);var t=setTimeout(function(){e.actions&&e.actions.setTyping(s,!1,null)},3e3);v(t)},[m]);var y=n?n.message||(n.file?c.a.createElement("span",{className:"file"},"file"):""):"";return c.a.createElement("div",{className:"chat-elem-wrap ".concat(e.chatId===s?"toggled":""),onClick:function(){return e.onClick()}},c.a.createElement("div",{className:"avatar"},c.a.createElement(Gt,{src:o,height:35,width:35,online:h,unread:e.unread})),c.a.createElement("div",{className:"info"},c.a.createElement("div",{className:"name-wrap"},c.a.createElement("div",{className:"name"},c.a.createElement(Wt.a,{text:t,length:10})),c.a.createElement("div",{className:"date"},c.a.createElement(zt.a,{date:a}))),d?c.a.createElement(Ut,null):u||"string"!==typeof y?y:c.a.createElement(Wt.a,{text:y,length:20})))},Yt=(a(564),a(666)),Vt=function(e){var t=Object(r.useState)(""),a=Object(l.a)(t,2),n=a[0],s=a[1];return c.a.createElement(c.a.Fragment,null,c.a.createElement(Yt.a,{onSubmit:function(){return n.trim()&&e.actions.search(n)}},c.a.createElement(qe.a,{loading:e.search.isFetching,value:n,icon:"user",placeholder:"Search...",iconPosition:"left",onChange:function(e,t){return s(t.value)}})),c.a.createElement(c.a.Fragment,null,e.search.data&&(e.search.data.length>0?c.a.createElement(c.a.Fragment,null,e.search.data.map(function(t){return c.a.createElement(qt,{key:t.id,id:t.id,name:t.username,avatar:t.avatar,online:t.online,onClick:function(){return function(t){var a=e.chatList.data.find(function(e){return e.user.id===t.id});if(a)return e.actions.fetchMessages(a.chat.id,t);e.actions.newChat(t.id)}(t)},show:!0})})):c.a.createElement(ze.a,{as:"h4",icon:!0,textAlign:"center"},c.a.createElement(Be.a,{name:"window close outline",size:"mini"}),"Not found"))))},Xt=Object(Me.b)(function(e){return{chatList:e.chatList,chat:e.chat,search:e.search,user:e.user}},function(e){return{actions:Object(m.bindActionCreators)(n,e)}})(function(e){Object(r.useEffect)(function(){e.chatList.data||e.actions.fetchChats()},[e.actions]);return c.a.createElement("div",{className:"chat-list-wrap"},e.search.isOpen?c.a.createElement(Vt,e):c.a.createElement(c.a.Fragment,null,e.chatList.data&&e.chatList.data.map(function(t){return t&&t.message&&c.a.createElement(qt,{key:t.chat.id,id:t.chat.id,chatId:e.chat.id,name:t.user.username,date:t.message.time,message:t.message,avatar:t.user.avatar,typing:t.isTyping||!1,timeTyping:t.timeTyping,actions:e.actions,online:t.user.online,time:t.user.time,unread:t.chat.userId!==e.user.data.id?t.chat.count:"",onClick:function(){return function(t){t.chat.id!==e.chat.id?e.actions.fetchMessages(t.chat.id,t.user):e.actions.closeChat()}(t)}})})))}),Zt=a(665),Kt=(a(573),a(669)),$t=a(338),Qt=a.n($t),ea=a(339),ta=a.n(ea),aa={},na={stompClient:aa,send:function(e,t,a){return aa.send(e,t,a)},connect:function(e,t){if(aa.connected)console.log("already connected");else{var a=t.user.data;(aa=ta.a.over(new Qt.a(ht))).connect({user:a.id},function(){console.log("Connected",t.user),aa.subscribe("/res/new-message/".concat(a.id),function(t){var a=t.body;return e.newMessage(JSON.parse(a))}),aa.subscribe("/res/new-chat/".concat(a.id),function(t){var n=t.body,r=JSON.parse(n);e.addChatToList(r.chatId,r.user1.id===a.id?r.user2:r.user1,a.id===r.user1.id)}),aa.subscribe("/res/delete-message/".concat(a.id),function(t){var a=t.body,n=JSON.parse(a);e.deleteMessageDone(n),e.fetchChats()}),aa.subscribe("/res/edit-message/".concat(a.id),function(t){var a=t.body,n=JSON.parse(a);e.editMessageDone(n),e.fetchChats()}),aa.subscribe("/res/new-typing/".concat(a.id),function(t){var a=t.body,n=JSON.parse(a).chatId;e.newTypingMessage(n)}),aa.subscribe("/res/online",function(t){var a=t.body,n=JSON.parse(a);e.onlineUser(n,!0)}),aa.subscribe("/res/offline",function(t){var a=t.body,n=JSON.parse(a);e.onlineUser(n,!1)}),aa.subscribe("/res/chat-read/"+a.id,function(t){var a=t.body,n=JSON.parse(a);e.setReadMessage(n)})})}}},ra=Object(Me.b)(function(e){return{user:e.user,chat:e.chat}},function(e){return{actions:Object(m.bindActionCreators)(n,e)}})(function(e){var t=Object(r.useState)(""),a=Object(l.a)(t,2),n=a[0],s=a[1],o=Object(r.useState)(!1),i=Object(l.a)(o,2),u=i[0],d=i[1],m=Object(r.useState)(!1),h=Object(l.a)(m,2),p=h[0],f=h[1],g=Object(r.useState)(null),b=Object(l.a)(g,2),E=b[0],O=b[1];Object(r.useEffect)(function(){n&&e.actions.typingMessage(e.chat.id,e.chat.user.id)},[n]);var v=function(){var e=Object(rt.a)(nt.a.mark(function e(t){var a,n;return nt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!=(a=t.target).files.length){e.next=3;break}return e.abrupt("return");case 3:if(-1===a.files[0].type.indexOf("image")){e.next=9;break}return e.next=6,Lt(a.files[0]);case 6:e.t0=e.sent,e.next=10;break;case 9:e.t0=0;case 10:n=e.t0,f(!0),d(!0),At(a.files[0],n).then(function(e){O(e),d(!1)}).catch(console.log);case 14:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),y=function(){if(n.length>255)return Ft.NotificationManager.error("Too long");f(!1),(n.trim()||E)&&(na.send("/req/new-message",{},JSON.stringify({chatId:e.chat.id,userId:e.user.data.id,message:n,file:E})),s(""),O(null))};return c.a.createElement(Yt.a,{onSubmit:function(e){return y()},className:"input-wrapper"},c.a.createElement(qe.a,{placeholder:"Type a message...",fluid:!0,value:n,onChange:function(e,t){return s(t.value)}}),c.a.createElement(Re.a,{color:"teal",icon:!0,as:"label"},c.a.createElement(Be.a,{name:"paperclip"}),c.a.createElement("input",{name:"image",type:"file",onChange:v,hidden:!0})),c.a.createElement(Ue.a,{open:p,basic:!0,size:"small"},c.a.createElement(Ue.a.Content,null,c.a.createElement(ze.a,{as:"h3",textAlign:"center",className:"white-header"},"Message with attached"),c.a.createElement(Kt.a,{icon:!0},u?c.a.createElement(Be.a,{name:"circle notched",loading:!0}):c.a.createElement(Be.a,{name:"file"}),c.a.createElement(Kt.a.Content,null,c.a.createElement(Kt.a.Header,null,E&&E.fileName),E&&Pt(E.size))),c.a.createElement(Yt.a,null,c.a.createElement(Je.a,{value:n,onChange:function(e,t){return s(t.value)},style:{minHeight:200}}))),c.a.createElement(Ue.a.Actions,{className:"action-btn"},c.a.createElement(Re.a,{color:"green",inverted:!0,onClick:function(){return u||y()}},c.a.createElement(Be.a,{name:"save",disabled:u})," Save"),c.a.createElement(Re.a,{color:"blue",inverted:!0,onClick:function(){f(!1),O(null)}},c.a.createElement(Be.a,{name:"cancel"})," Cancel"))))}),ca=(a(608),a(340)),sa=a.n(ca);lt.a.extend(dt.a);var oa=Object(Me.b)(function(){return{}},function(e){return{actions:Object(m.bindActionCreators)(n,e)}})(function(e){var t=e.message,a=e.user,n=e.actions,s=e.checked,o=t.user.id===a.id,i=Object(r.useState)(!1),u=Object(l.a)(i,2),d=u[0],m=u[1],h=Object(r.useState)(!1),p=Object(l.a)(h,2),f=p[0],g=p[1],b=Object(r.useState)(t.message),E=Object(l.a)(b,2),O=E[0],v=E[1],y=function(){return e.actions.sendEmail(t)};return c.a.createElement("div",{className:"message-item ".concat(d?"to-delete":""," ").concat(f?"to-edit":""),style:{alignItems:o?"flex-end":"flex-start"}},c.a.createElement("div",{className:"message-wrap ".concat(o?"from-me":"from-them")},t.file&&(-1===t.file.fileType.indexOf("image")?c.a.createElement(Kt.a,{icon:!0,compact:!0,size:"mini",info:!0},c.a.createElement(Be.a,{name:"file",onClick:function(){return t.file&&window.open(t.file.fileDownloadUri,"_blank")}}),c.a.createElement(Kt.a.Content,null,c.a.createElement(Kt.a.Header,null,t.file&&t.file.fileName),t.file&&Pt(t.file.size))):c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{style:{marginBottom:10,height:t.file.height}},c.a.createElement(Ge.a,{src:t.file.fileDownloadUri,wrapped:!0,as:"a",className:"image-fit",href:t.file.fileDownloadUri,target:"_blank"})))),c.a.createElement("div",{style:{whiteSpace:"pre-wrap"}},sa()(t.message)),c.a.createElement("span",{className:"info-block",style:{justifyContent:o?"space-between":a.options.sendMessage?"space-between":"flex-end"}},!o&&a.confirm&&a.options.sendMessage&&c.a.createElement("span",null,c.a.createElement(Be.a,{name:"mail",size:"small",onClick:y})),c.a.createElement("span",{className:"time"},c.a.createElement(zt.a,{date:t.time})),o&&c.a.createElement("span",{className:"icons"},s&&c.a.createElement(Be.a,{name:"check",size:"small"}),a.confirm&&a.options.sendMessage&&c.a.createElement(Be.a,{name:"mail",size:"small",onClick:y}),c.a.createElement(Ue.a,{trigger:c.a.createElement(Be.a,{name:"trash",size:"small",onClick:function(){return m(!0)}}),open:d,onClose:function(){return m(!1)},basic:!0,size:"small"},c.a.createElement(Ue.a.Content,null,c.a.createElement(ze.a,{as:"h3",textAlign:"center",className:"white-header"},"Are you sure you want to delete the message?")),c.a.createElement(Ue.a.Actions,{className:"action-btn"},c.a.createElement(Re.a,{color:"red",onClick:function(){m(!1),n.deleteMessage(t.id,t.chat.id)},inverted:!0},c.a.createElement(Be.a,{name:"trash"})," Delete"),c.a.createElement(Re.a,{color:"green",onClick:function(){return m(!1)},inverted:!0},c.a.createElement(Be.a,{name:"cancel"})," Cancel"))),c.a.createElement(Ue.a,{trigger:c.a.createElement(Be.a,{name:"edit",size:"small",onClick:function(){return g(!0)}}),open:f,onClose:function(){return g(!1)},basic:!0,size:"small"},c.a.createElement(Ue.a.Content,null,c.a.createElement(ze.a,{as:"h3",textAlign:"center",className:"white-header"},"Edit message"),c.a.createElement(Yt.a,null,c.a.createElement(Je.a,{value:O,onChange:function(e,t){return v(t.value)},style:{minHeight:200}}))),c.a.createElement(Ue.a.Actions,{className:"action-btn"},c.a.createElement(Re.a,{color:"green",onClick:function(){if(O.length>255)return Ft.NotificationManager.error("Too long");g(!1),n.editMessage(t.id,t.chat.id,O)},inverted:!0},c.a.createElement(Be.a,{name:"edit"})," Edit"),c.a.createElement(Re.a,{color:"blue",onClick:function(){return g(!1)},inverted:!0},c.a.createElement(Be.a,{name:"cancel"})," Cancel")))))))}),ia=a(341),la=function(e){return 0===e.scrollTop},ua=function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).isScrolledDownThreshold,a=void 0===t?150:t;return function(t){function n(e){var t;return Object(Ve.a)(this,n),(t=Object(Ze.a)(this,Object(Ke.a)(n).call(this,e))).shouldScroll=!0,t._isScrolledDown=!0,t._el=null,t._scrollHeight=null,t._isScrolledUp=null,t.state={size:(t.props.chat.data||[]).length},t}return Object(Qe.a)(n,t),Object(Xe.a)(n,[{key:"scrollDownIfNeeded",value:function(){var e;this.shouldScroll&&(e=this._el).clientHeight<e.scrollHeight&&(function(e){e.scrollTop=e.scrollHeight-e.clientHeight}(this._el),this.shouldScroll=!1)}},{key:"handleScroll",value:function(e){var t,n;this._isScrolledDown=(t=this._el,n=a,t.scrollTop+t.clientHeight>=t.scrollHeight-n),la(this._el)&&this.props.onScrolledTop&&this.props.onScrolledTop(e),this.props.onScrolled&&this.props.onScrolled(e)}},{key:"componentDidMount",value:function(){this.scrollDownIfNeeded()}},{key:"componentWillUpdate",value:function(e,t){this.setState({size:e.chat.data.length}),this.shouldScroll=e.chat.data.length>this.state.size,this._scrollHeight=this._el.scrollHeight,this._isScrolledUp=la(this._el)}},{key:"componentDidUpdate",value:function(){if(this._isScrolledUp&&null!==this._scrollHeight){var e=this._el.scrollHeight-this._scrollHeight;this._scrollHeight=null,t=e,this._el.scrollTop+=t}else this.scrollDownIfNeeded();var t}},{key:"render",value:function(){var t=this,a=this.props,n=(a.onScrolled,a.onScrolledTop,Object(ia.a)(a,["onScrolled","onScrolledTop"]));return c.a.createElement(e,Object.assign({},n,{ref:function(e){return t._el=o.a.findDOMNode(e)},onScroll:function(e){return t.handleScroll(e)}}))}}]),n}(c.a.PureComponent)}(function(e){function t(){return Object(Ve.a)(this,t),Object(Ze.a)(this,Object(Ke.a)(t).apply(this,arguments))}return Object(Qe.a)(t,e),Object(Xe.a)(t,[{key:"componentDidUpdate",value:function(e,t,a){try{var n=this.props.chat.data;n.length>e.chat.data.length&&n[n.length-1].user.id!==this.props.user.id&&(console.log("i read"),this.props.actions.readChat(this.props.chat.id,this.props.chat.user.id))}catch(r){console.log(r)}}},{key:"render",value:function(){var e=this,t=function(t){return e.props.chat.userId!==e.props.user.id||e.props.chat.data.length-t>=e.props.chat.count+1};return c.a.createElement("div",Object.assign({className:"messages-wrap"},this.props),c.a.createElement("div",null,(this.props.chat.data||[]).map(function(a,n){return c.a.createElement(oa,{checked:t(n),key:a.id,message:a,user:e.props.user})})))}}]),t}(c.a.Component)),da=Object(Me.b)(function(e){return{chat:e.chat,user:e.user}},function(e){return{actions:Object(m.bindActionCreators)(n,e)}})(function(e){return c.a.createElement("div",{className:"chat-page-wrapper"},e.chat.isOpen?e.chat.isFetching?c.a.createElement("div",{className:"loader-wrap"},c.a.createElement(Zt.a,{active:!0,inline:"centered"})):c.a.createElement(c.a.Fragment,null,c.a.createElement(ua,{chat:e.chat,user:e.user.data,actions:e.actions}),c.a.createElement("div",{className:"input-wrap"},c.a.createElement(ra,null))):c.a.createElement("div",{style:{alignItems:"center",display:"flex",justifyContent:"center",flexDirection:"column",height:"100%"}},c.a.createElement(ze.a,{as:"h3",textAlign:"center"},"Select chat to start texting")))}),ma=a(673),ha=Object(Me.b)(function(e){return{state:e,showPanel:e.showPanel,user:e.user}},function(e){return{actions:Object(m.bindActionCreators)(n,e)}})(function(e){return Object(r.useEffect)(function(){e.actions&&e.user.data&&(console.log("init"),na.connect(e.actions,e.state))},[e.actions,e.user]),Object(r.useEffect)(function(){e.actions.fetchUser()},[e.actions]),e.user.data&&!e.user.isFetching?c.a.createElement("div",{className:"main-wrapper"},c.a.createElement("div",{style:{background:"white"}},c.a.createElement(Bt,null),c.a.createElement("div",{className:"content-wrap"},e.showPanel&&c.a.createElement(Xt,e),c.a.createElement(da,null)))):c.a.createElement(ma.a,{active:!0,inverted:!0},c.a.createElement(Zt.a,{inverted:!0}))}),pa=(a(647),a(670)),fa=a(671),ga=Object(Me.b)(function(e){return{showPanel:e.showPanel,loginPage:e.loginPage}},function(e){return{actions:Object(m.bindActionCreators)(n,e)}})(function(e){var t=Object(r.useState)(""),a=Object(l.a)(t,2),n=a[0],s=a[1],o=Object(r.useState)(""),i=Object(l.a)(o,2),u=i[0],d=i[1];return c.a.createElement(pa.a,{textAlign:"center",style:{position:"absolute",top:"30%",left:"35%"},verticalAlign:"middle"},c.a.createElement(pa.a.Column,{style:{width:500,background:"white"}},c.a.createElement(ze.a,{as:"h2",textAlign:"center"},"Login to your account"),c.a.createElement(Yt.a,{size:"large"},c.a.createElement(fa.a,{stacked:!0},c.a.createElement(Yt.a.Input,{fluid:!0,icon:"user",iconPosition:"left",placeholder:"E-mail address",value:n,onChange:function(e,t){return s(t.value)}}),c.a.createElement(Yt.a.Input,{fluid:!0,icon:"lock",iconPosition:"left",placeholder:"Password",type:"password",value:u,onChange:function(e,t){return d(t.value)},error:e.loginPage&&!!e.loginPage.error}),c.a.createElement(Re.a,{className:"color-btn",fluid:!0,size:"large",onClick:function(){return e.actions.loginUser(n,u)},loading:e.loginPage&&e.loginPage.isFetching},"Login"))),e.loginPage&&!!e.loginPage.error&&c.a.createElement(Kt.a,{error:!0,content:e.loginPage.error}),c.a.createElement(Kt.a,null,"New to us? ",c.a.createElement("a",{href:"#",onClick:function(){return e.actions.changePage("reg")}},"Sign Up"))))}),ba=a(342),Ea=a.n(ba),Oa=(a(648),Object(ct.a)(function(e){for(var t=[],a=0;a<e;a++)t[a]=ot.a.avatar();return t}(14))),va=Object(Me.b)(function(e){return{showPanel:e.showPanel,regPage:e.regPage}},function(e){return{actions:Object(m.bindActionCreators)(n,e)}})(function(e){var t=Object(r.useState)(""),a=Object(l.a)(t,2),n=a[0],s=a[1],o=Object(r.useState)(""),i=Object(l.a)(o,2),u=i[0],d=i[1],m=Object(r.useState)(""),h=Object(l.a)(m,2),p=h[0],f=h[1];return c.a.createElement(pa.a,{textAlign:"center",style:{position:"absolute",top:"20%",left:"35%"},verticalAlign:"middle"},c.a.createElement(pa.a.Column,{style:{width:500,background:"white"}},c.a.createElement(ze.a,{as:"h2",textAlign:"center"},"Create an account"),c.a.createElement(Yt.a,{size:"large"},c.a.createElement(fa.a,{stacked:!0},c.a.createElement(Yt.a.Input,{fluid:!0,icon:"user",iconPosition:"left",placeholder:"User name",value:n,onChange:function(e,t){return s(t.value)}}),c.a.createElement(Yt.a.Input,{fluid:!0,icon:"lock",iconPosition:"left",placeholder:"Password",type:"password",value:u,onChange:function(e,t){return d(t.value)}}),c.a.createElement(ze.a,{as:"h4",textAlign:"left"},"Choose a photo"),c.a.createElement(Ea.a,{images:Oa.map(function(e,t){return{src:e,value:t}}),onPick:function(e){return f(e.src)}}),c.a.createElement(Re.a,{className:"color-btn",fluid:!0,size:"large",onClick:function(){return e.actions.regUser(n,u,p)},loading:e.regPage&&e.regPage.isFetching},"Sign up"))),e.regPage&&!!e.regPage.error&&c.a.createElement(Kt.a,{error:!0,content:e.regPage.error}),c.a.createElement(Kt.a,null,"Already has account? ",c.a.createElement("a",{href:"#",onClick:function(){return e.actions.changePage("login")}},"Login"))))}),ya=(a(308),function(){particlesJS("particles-js",{particles:{number:{value:80,density:{enable:!0,value_area:800}},color:{value:"#ffffff"},shape:{type:"circle",stroke:{width:0,color:"#000000"},polygon:{nb_sides:5},image:{src:"img/github.svg",width:100,height:100}},opacity:{value:.5,random:!1,anim:{enable:!1,speed:1,opacity_min:.1,sync:!1}},size:{value:5,random:!0,anim:{enable:!1,speed:40,size_min:.1,sync:!1}},line_linked:{enable:!0,distance:150,color:"#ffffff",opacity:.4,width:1},move:{enable:!0,speed:2,direction:"none",random:!1,straight:!1,out_mode:"out",attract:{enable:!1,rotateX:600,rotateY:1200}}},interactivity:{detect_on:"canvas",events:{onhover:{enable:!0,mode:"repulse"},onclick:{enable:!0,mode:"push"},resize:!0},modes:{grab:{distance:400,line_linked:{opacity:1}},bubble:{distance:400,size:40,duration:2,opacity:8,speed:3},repulse:{distance:200},push:{particles_nb:4},remove:{particles_nb:2}}},retina_detect:!0,config_demo:{hide_card:!1,background_color:"#b61924",background_image:"",background_position:"50% 50%",background_repeat:"no-repeat",background_size:"cover"}})}),ja=function(e){return Object(r.useEffect)(function(){ya()},[]),c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{id:"particles-js"}),"login"===e.page?c.a.createElement(ga,null):c.a.createElement(va,null))},wa=(a(649),a(650),function(){var e=Object(rt.a)(nt.a.mark(function e(t,a){var n,r,c;return nt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a&&a.headers?Object(He.a)({},Tt().headers,{},a.headers):Tt().headers,a&&a.body&&(n=new Headers(Object(He.a)({"Content-Type":"application/json"},n))),e.next=4,fetch(t,Object(He.a)({},a||{},{headers:n}));case 4:if((r=e.sent).ok){e.next=15;break}return console.error(r),e.next=9,r.json();case 9:if(c=e.sent,console.log(c),"Token has expired"!==c.message){e.next=14;break}return localStorage.removeItem("token"),e.abrupt("return",window.location.reload());case 14:throw new Error(c.message||c[0]);case 15:return e.next=17,r.json();case 17:return e.abrupt("return",e.sent);case 18:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}()),Sa=function(e){var t=Object(r.useState)(!0),a=Object(l.a)(t,2),n=a[0],s=a[1],o=Object(r.useState)(!1),i=Object(l.a)(o,2),u=i[0],d=i[1];return Object(r.useEffect)(function(){wa(Nt,{method:"POST",body:JSON.stringify({token:e.token})}).then(function(e){e||d(!0),s(!1)}).catch(function(e){console.log(e),d(!0),s(!1)})},[]),c.a.createElement("div",{className:"confirm-wrap"}," ",n?c.a.createElement(ma.a,{inverted:!0},c.a.createElement(Zt.a,{inverted:!0})):c.a.createElement(ma.a,{active:!0},c.a.createElement(ze.a,{as:"h2",icon:!0,color:"black"},c.a.createElement(Be.a,{name:u?"close":"check circle",color:u?"red":"green"}),"Email doesn't confirmed!",c.a.createElement(ze.a.Subheader,null,c.a.createElement("span",{onClick:function(){return window.location.replace("/")}},"Go to app")))))},ka=Object(Me.b)(function(e){return{page:e.page}})(function(e){switch(e.page){case"login":case"reg":return c.a.createElement(ja,{page:e.page});default:if(-1===window.location.href.indexOf("/email"))return c.a.createElement("div",{className:"App"},c.a.createElement(ha,null),c.a.createElement(Ft.NotificationContainer,null));var t=window.location.pathname.split("/"),a=Object(i.a)(t),n=a[1],r=a.slice(2);return"email-confirm"===n?c.a.createElement(Sa,{token:r.join("/")}):"email-reset"===n?c.a.createElement("span",null,"reset"):c.a.createElement("span",null,"not found")}});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Ca=a(23),Na=nt.a.mark(qa),xa=nt.a.mark(Ya),Ia=nt.a.mark(Va),Ta=nt.a.mark(Xa),_a=nt.a.mark(Za),Aa=nt.a.mark(Ka),Pa=nt.a.mark($a),La=nt.a.mark(Qa),Da=nt.a.mark(en),Ma=nt.a.mark(tn),Fa=nt.a.mark(an),Ha=nt.a.mark(nn),Ua=nt.a.mark(rn),Ga=nt.a.mark(cn),Ra=nt.a.mark(sn),za=nt.a.mark(on),Ba=nt.a.mark(ln),Ja=nt.a.mark(un),Wa=nt.a.mark(dn);function qa(e){var t;return nt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,wa(pt);case 3:return t=e.sent,e.next=6,Object(Ca.a)({type:p,payload:t});case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}},Na,null,[[0,8]])}function Ya(e){var t;return nt.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,wa(ft+e.payload.id,{headers:Tt().headers});case 3:return t=a.sent,a.next=6,Object(Ca.a)({type:g,payload:t});case 6:a.next=11;break;case 8:a.prev=8,a.t0=a.catch(0),console.log(a.t0);case 11:case"end":return a.stop()}},xa,null,[[0,8]])}function Va(e){var t;return nt.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,wa(gt,{method:"POST",body:JSON.stringify({username:e.payload.login,password:e.payload.password}),headers:{"X-Requested-With":"XMLHttpRequest"}});case 3:return t=a.sent,localStorage.setItem("token",t.token),a.next=7,Object(Ca.a)({type:k,payload:"chat"});case 7:a.next=14;break;case 9:return a.prev=9,a.t0=a.catch(0),a.next=13,Object(Ca.a)({type:j,payload:{error:a.t0.message}});case 13:console.error(a.t0);case 14:case"end":return a.stop()}},Ia,null,[[0,9]])}function Xa(e){var t;return nt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,wa(bt,{method:"GET",headers:Tt().headers});case 3:return t=e.sent,e.next=6,Object(Ca.a)({type:x,payload:{user:t}});case 6:e.next=13;break;case 8:return e.prev=8,e.t0=e.catch(0),localStorage.removeItem("token"),e.next=13,Object(Ca.a)({type:C});case 13:case"end":return e.stop()}},Ta,null,[[0,8]])}function Za(e){var t,a,n,r;return nt.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return t=e.payload,a=t.login,n=t.password,r=t.avatar,c.prev=1,c.next=4,wa(Et,{method:"POST",body:JSON.stringify({username:a,password:n,avatar:r})});case 4:return c.next=6,Object(Ca.a)({type:y,payload:{login:a,password:n}});case 6:c.next=12;break;case 8:return c.prev=8,c.t0=c.catch(1),c.next=12,Object(Ca.a)({type:S,payload:{error:c.t0.message}});case 12:case"end":return c.stop()}},_a,null,[[1,8]])}function Ka(e){var t;return nt.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,wa(Ot+"?search=".concat(e.payload.search));case 3:return t=a.sent,a.next=6,Object(Ca.a)({type:T,payload:t});case 6:a.next=11;break;case 8:a.prev=8,a.t0=a.catch(0),console.error(a.t0);case 11:case"end":return a.stop()}},Aa,null,[[0,8]])}function $a(e){var t;return nt.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,wa(vt,{method:"PUT",body:JSON.stringify({userId:e.payload.userId})});case 3:return t=a.sent,a.next=6,Object(Ca.a)({type:A,payload:{chatId:t.chatId}});case 6:a.next=11;break;case 8:a.prev=8,a.t0=a.catch(0),console.error(a.t0);case 11:case"end":return a.stop()}},Pa,null,[[0,8]])}function Qa(e){return nt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,wa(yt+"/".concat(e.payload.messageId),{method:"DELETE",body:JSON.stringify({chatId:e.payload.chatId})});case 3:t.next=8;break;case 5:t.prev=5,t.t0=t.catch(0),console.log(t.t0);case 8:case"end":return t.stop()}},La,null,[[0,5]])}function en(e){return nt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,wa(yt+"/".concat(e.payload.messageId),{method:"POST",body:JSON.stringify({chatId:e.payload.chatId,message:e.payload.message})});case 3:t.next=8;break;case 5:t.prev=5,t.t0=t.catch(0),console.log(t.t0);case 8:case"end":return t.stop()}},Da,null,[[0,5]])}function tn(e){var t;return nt.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,wa(wt,{method:"POST",body:JSON.stringify({src:e.payload.src})});case 3:if(!(t=a.sent)){a.next=7;break}return a.next=7,Object(Ca.a)({type:U,payload:{src:t}});case 7:a.next=12;break;case 9:a.prev=9,a.t0=a.catch(0),console.log(a.t0);case 12:case"end":return a.stop()}},Ma,null,[[0,9]])}function an(e){var t;return nt.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,wa(St,{method:"POST",body:JSON.stringify({message:e.payload.message})});case 3:return t=a.sent,a.next=6,Object(Ca.a)({type:R,payload:{message:t}});case 6:a.next=11;break;case 8:a.prev=8,a.t0=a.catch(0),console.log(a.t0);case 11:case"end":return a.stop()}},Fa,null,[[0,8]])}function nn(e){var t;return nt.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,wa(kt,{method:"POST",body:JSON.stringify({email:e.payload.email})});case 3:return t=a.sent,a.next=6,Object(Ca.a)({type:B,payload:{email:t}});case 6:a.next=11;break;case 8:a.prev=8,a.t0=a.catch(0),console.log(a.t0);case 11:case"end":return a.stop()}},Ha,null,[[0,8]])}function rn(e){return nt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,wa(Ct,{method:"POST",body:JSON.stringify({email:e.payload.email})});case 3:t.sent&&Ft.NotificationManager.info("Confirm email send"),t.next=11;break;case 7:t.prev=7,t.t0=t.catch(0),Ft.NotificationManager.error("Something go wrong"),console.log(t.t0);case 11:case"end":return t.stop()}},Ua,null,[[0,7]])}function cn(e){return nt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,wa(xt,{method:"POST",body:JSON.stringify(Object(He.a)({},e.payload.options))});case 3:if(!t.sent){t.next=7;break}return t.next=7,Object(Ca.a)({type:q,payload:{options:e.payload.options}});case 7:t.next=12;break;case 9:t.prev=9,t.t0=t.catch(0),console.log(t.t0);case 12:case"end":return t.stop()}},Ga,null,[[0,9]])}function sn(e){return nt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,wa(It,{method:"POST",body:JSON.stringify({messageId:e.payload.message.id})});case 3:Ft.NotificationManager.info("Email was send"),t.next=10;break;case 6:t.prev=6,t.t0=t.catch(0),console.log(t.t0),Ft.NotificationManager.error("Something go wrong with email");case 10:case"end":return t.stop()}},Ra,null,[[0,6]])}function on(e){return nt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,na.send("/req/new-typing",{},JSON.stringify({chatId:e.payload.chatId,userId:e.payload.userId}));case 3:t.next=8;break;case 5:t.prev=5,t.t0=t.catch(0),console.log(t.t0);case 8:case"end":return t.stop()}},za,null,[[0,5]])}function ln(e){var t,a,n;return nt.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,t=e.payload.chatId,r.next=4,Object(Ca.b)(function(e){return(e.chatList.data||[]).find(function(e){return e.chat.id===t})});case 4:if(a=r.sent,n=new Date,a){r.next=8;break}throw new Error("no such chat");case 8:return r.next=10,Object(Ca.a)({type:$,payload:{chatId:t,isTyping:!0,timeTyping:n}});case 10:r.next=15;break;case 12:r.prev=12,r.t0=r.catch(0),console.log("NEW TYPING ERROR: ",r.t0);case 15:case"end":return r.stop()}},Ba,null,[[0,12]])}function un(e){return nt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,na.send("/req/message-read",{},JSON.stringify({userId:e.payload.userId,chatId:e.payload.chatId}));case 3:t.next=8;break;case 5:t.prev=5,t.t0=t.catch(0),console.log(t.t0);case 8:case"end":return t.stop()}},Ja,null,[[0,5]])}function dn(){return nt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Ca.c)(h,qa);case 2:return e.next=4,Object(Ca.c)(f,Ya);case 4:return e.next=6,Object(Ca.c)(y,Va);case 6:return e.next=8,Object(Ca.c)(N,Xa);case 8:return e.next=10,Object(Ca.c)(w,Za);case 10:return e.next=12,Object(Ca.c)(I,Ka);case 12:return e.next=14,Object(Ca.c)(_,$a);case 14:return e.next=16,Object(Ca.c)(L,Qa);case 16:return e.next=18,Object(Ca.c)(M,en);case 18:return e.next=20,Object(Ca.c)(H,tn);case 20:return e.next=22,Object(Ca.c)(G,an);case 22:return e.next=24,Object(Ca.c)(z,nn);case 24:return e.next=26,Object(Ca.c)(J,rn);case 26:return e.next=28,Object(Ca.c)(W,cn);case 28:return e.next=30,Object(Ca.c)(Y,sn);case 30:return e.next=32,Object(Ca.c)(Z,on);case 32:return e.next=34,Object(Ca.c)(K,ln);case 34:return e.next=36,Object(Ca.c)(te,un);case 36:case"end":return e.stop()}},Wa)}var mn={chatList:{data:null,isFetching:!1},user:{isFetching:!1,data:null},chat:{id:null,isFetching:!1,isOpen:!1,data:[],user:null,count:0,userId:null},showPanel:!0,page:localStorage.getItem("token")&&"undefined"!==localStorage.getItem("token")?"chat":"login",search:{isFetching:!1,isOpen:!1}};function hn(){var e,t,a,n,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:mn,c=arguments.length>1?arguments[1]:void 0;switch(c.type){case h:return Object(He.a)({},r,{chatList:Object(He.a)({},r.chatList,{isFetching:!0})});case E:return Object(He.a)({},r,{showPanel:!r.showPanel});case O:return Object(He.a)({},r,{search:Object(He.a)({},r.search,{isOpen:!r.search.isOpen}),showPanel:!0});case p:return Object(He.a)({},r,{chatList:Object(He.a)({},r.chatList,{data:_t(c.payload),isFetching:!1})});case f:return Object(He.a)({},r,{chat:Object(He.a)({},r.chat,{id:c.payload.id,isFetching:!0,isOpen:!0,user:c.payload.user}),chatList:Object(He.a)({},r.chatList,{data:(r.chatList.data||[]).map(function(e){return c.payload.id===e.chat.id?Object(He.a)({},e,{chat:Object(He.a)({},e.chat,{},c.payload.user.id===e.chat.userId?{count:0,userId:null}:{})}):e})})});case g:return t=c.payload.length&&c.payload[0],Object(He.a)({},r,{chat:Object(He.a)({},r.chat,{count:t?t.chat.count:0,userId:t?t.chat.userId:0,data:c.payload,isFetching:!1})});case v:return t=c.payload.message,e=Object(ct.a)(r.chatList.data||[]).map(function(e){return e.chat.id===t.chat.id&&(e.message=t,e.chat.count=t.chat.count,e.chat.userId=t.chat.userId),e}),Object(He.a)({},r,{chatList:Object(He.a)({},r.chatList,{data:_t(e)}),chat:Object(He.a)({},r.chat,{count:r.chat.count+1,data:r.chat.id===t.chat.id?[].concat(Object(ct.a)(r.chat.data||[]),[c.payload.message]):r.chat.data})});case k:return Object(He.a)({},r,{page:c.payload});case C:return Object(He.a)({},mn,{page:"login"});case N:return Object(He.a)({},r,{user:Object(He.a)({},r.user,{isFetching:!0})});case x:return Object(He.a)({},r,{user:Object(He.a)({},r.user,{isFetching:!1,data:Object(He.a)({},c.payload.user,{online:!0,time:new Date})})});case y:return Object(He.a)({},r,{loginPage:{isFetching:!0,error:null}});case j:return Object(He.a)({},r,{loginPage:{isFetching:!1,error:c.payload.error}});case w:return Object(He.a)({},r,{regPage:{isFetching:!0,error:null}});case S:return Object(He.a)({},r,{regPage:{isFetching:!1,error:c.payload.error}});case I:return Object(He.a)({},r,{search:Object(He.a)({},r.search,{isFetching:!0})});case T:return Object(He.a)({},r,{search:Object(He.a)({},r.search,{isFetching:!1,data:c.payload})});case _:return Object(He.a)({},r,{chat:Object(He.a)({},r.chat,{isFetching:!0,isOpen:!0,user:c.payload.user})});case A:return Object(He.a)({},r,{chat:Object(He.a)({},r.chat,{id:c.payload.chatId,isFetching:!1,data:[]})});case P:return(e=Object(ct.a)(r.chatList.data||[])).push({chat:{id:c.payload.chatId,count:0,userId:null},message:null,user:c.payload.user}),Object(He.a)({},r,{chatList:Object(He.a)({},r.chatList,{data:_t(e)}),chat:c.payload.setChat?{id:c.payload.chatId,isFetching:!1,isOpen:!0,data:[],user:c.payload.user,count:0,userId:null}:r.chat});case D:return(t=c.payload.message).chat.id!==r.chat.id?r:(a=Object(ct.a)(r.chat.data||[]).map(function(e){return e.id===t.id?void 0:e}).filter(function(e){return e}),Object(He.a)({},r,{chat:Object(He.a)({},r.chat,{data:a})}));case F:return(t=c.payload.message).chat.id!==r.chat.id?r:(a=Object(ct.a)(r.chat.data||[]).map(function(e){return e.id===t.id?t:e}),Object(He.a)({},r,{chat:Object(He.a)({},r.chat,{data:a})}));case b:return Object(He.a)({},r,{chat:mn.chat});case U:return Object(He.a)({},r,{user:Object(He.a)({},r.user,{data:Object(He.a)({},r.user.data||{},{avatar:c.payload.src})})});case R:return Object(He.a)({},r,{user:Object(He.a)({},r.user,{data:Object(He.a)({},r.user.data||{},{about:c.payload.message})})});case B:return Object(He.a)({},r,{user:Object(He.a)({},r.user,{data:Object(He.a)({},r.user.data||{},{email:c.payload.email,confirm:!1})})});case q:return Object(He.a)({},r,{user:Object(He.a)({},r.user,{data:Object(He.a)({},r.user.data||{},{options:c.payload.options})})});case V:return Object(He.a)({},r,{loginPage:mn.loginPage});case X:return Object(He.a)({},r,{regPage:mn.regPage});case $:var s=(e=r.chatList.data||[]).findIndex(function(e){return e.chat.id===c.payload.chatId});if(-1===s)return r;var o=Object(He.a)({},e[s]);return o.isTyping=c.payload.isTyping,o.timeTyping=c.payload.timeTyping,e[s]=o,Object(He.a)({},r,{chatList:Object(He.a)({},r.chatList,{data:e}),chat:r.chat.id!==c.payload.chatId?r.chat:Object(He.a)({},r.chat,{isTyping:c.payload.isTyping})});case Q:return Object(He.a)({},r,{user:Object(He.a)({},r.user,{data:r.user.data?Object(He.a)({},r.user.data,{online:c.payload.status,time:new Date}):r.user.data}),chat:Object(He.a)({},r.chat,{user:r.chat.user?Object(He.a)({},r.chat.user,{online:c.payload.status,time:new Date}):r.chat.user}),chatList:Object(He.a)({},r.chatList,{data:r.chatList.data?r.chatList.data.map(function(e){return Object(He.a)({},e,{user:e.user&&e.user.id===c.payload.userId?Object(He.a)({},e.user,{online:c.payload.status,time:new Date}):e.user})}):r.chatList.data}),search:Object(He.a)({},r.search,{data:r.search.data?r.search.data.map(function(e){return Object(He.a)({},e,{online:c.payload.status,time:new Date})}):r.search.data})});case ee:case te:return n=c.payload.chatId,Object(He.a)({},r,{chatList:Object(He.a)({},r.chatList,{data:(r.chatList.data||[]).map(function(e){return n===e.chat.id?Object(He.a)({},e,{chat:Object(He.a)({},e.chat,{count:0,userId:null})}):e})}),chat:r.chat.id!==n?r.chat:Object(He.a)({},r.chat,{count:0,userId:null})});case ae:return n=c.payload.chatId,Object(He.a)({},r,{chatList:Object(He.a)({},r.chatList,{data:(r.chatList.data||[]).map(function(e){return n===e.chat.id?Object(He.a)({},e,{chat:Object(He.a)({},e.chat,{count:e.chat.count+1})}):e})}),chat:r.chat.id!==n?r.chat:Object(He.a)({},r.chat,{count:r.chat.count+1})});default:return r}}var pn=a(344),fn=a(343),gn=function(){var e=Object(pn.a)(),t=Object(m.createStore)(hn,Object(fn.composeWithDevTools)(Object(m.applyMiddleware)(e)));return e.run(dn),t}();o.a.render(c.a.createElement(Me.a,{store:gn},c.a.createElement(ka,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[356,1,2]]]);
//# sourceMappingURL=main.27b8616a.chunk.js.map